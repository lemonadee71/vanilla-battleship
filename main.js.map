{"version":3,"sources":["webpack://battleship-vanilla/./src/App.js","webpack://battleship-vanilla/./src/Game.js","webpack://battleship-vanilla/./src/component.js","webpack://battleship-vanilla/./src/components/Board.js","webpack://battleship-vanilla/./src/components/PlayerBoard.js","webpack://battleship-vanilla/./src/event.js","webpack://battleship-vanilla/./src/modules/Gameboard.js","webpack://battleship-vanilla/./src/modules/Player.js","webpack://battleship-vanilla/./src/modules/Ship.js","webpack://battleship-vanilla/./src/utils.js","webpack://battleship-vanilla/webpack/bootstrap","webpack://battleship-vanilla/webpack/runtime/define property getters","webpack://battleship-vanilla/webpack/runtime/hasOwnProperty shorthand","webpack://battleship-vanilla/webpack/runtime/make namespace object","webpack://battleship-vanilla/./src/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAA0B;AACsB;;AAEhD;AACA,sBAAsB,uDAAW;AACjC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,SAAS,4CAAI;AACb;AACA;AACA;AACA;AACA;AACA,cAAc,4CAAI;AAClB;AACA,uCAAuC,wBAAwB;AAC/D;AACA;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA,cAAc,4CAAI,GAAG,8CAAI,oBAAoB;AAC7C;AACA;AACA;AACA;AACA;;AAEA,iEAAe,GAAG,EAAC;;;;;;;;;;;;;;;;;;;;;;;;;AC3C6B;AACT;AACL;AACU;AACuB;AACxB;AACD;AACM;AACG;AACvB;;AAE5B;AACA;AACA,sBAAsB,uDAAW;AACjC,0BAA0B,uDAAW;AACrC,SAAS,cAAc,GAAG,6CAAU;;AAEpC;AACA,yBAAyB,2DAAS;;AAElC;AACA;;AAEA;AACA;;AAEA;AACA;AACA,qBAAqB,gEAAe;AACpC,4BAA4B,wCAAc;AAC1C,yBAAyB,kDAAI;;AAE7B;AACA,kCAAkC,gBAAgB;AAClD;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,oBAAoB,uDAAW;AAC/B;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAkB,0DAAkB;AACpC;AACA;AACA,YAAY;AACZ;AACA,KAAK;;AAEL;AACA,iBAAiB,+DAAc;AAC/B,IAAI,+CAAC,+CAA+C,KAAK;AACzD;AACA;;AAEA,EAAE,8CAAQ;AACV,oBAAoB,UAAU;AAC9B;AACA,GAAG;AACH,EAAE,8CAAQ;AACV;;AAEA;AACA;AACA;AACA,GAAG;;AAEH,SAAS,4CAAI;AACb,eAAe,wBAAwB;AACvC;AACA;AACA;AACA;AACA,cAAc,4CAAI,YAAY,sBAAsB;AACpD,2BAA2B,0BAA0B;AACrD,0CAA0C;AAC1C,oBAAoB,0DAAK;AACzB;AACA;AACA;AACA,mBAAmB;AACnB,oBAAoB,0DAAK;AACzB;AACA;AACA;AACA,mBAAmB;AACnB;AACA,cAAc,4CAAI,2BAA2B;AAC7C,kBAAkB,gEAAW;AAC7B,kBAAkB,gEAAW;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA,iEAAe,IAAI,EAAC;;;;;;;;;;;;;;;;;;;ACzHW;;AAE/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,4CAAI;AACjB,2BAA2B,KAAK;AAChC,sBAAsB,SAAS,IAAI,GAAG;;AAEtC;AACA;AACA;AACA,iBAAiB,SAAS;AAC1B;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA,aAAa,4CAAI;AACjB,oCAAoC,GAAG;AACvC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,QAAQ,GAAG,cAAc;AACnD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,KAAK;AAClB;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,gCAAgC,aAAa;AAC7C;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA,kDAAkD,GAAG;;AAErD,iDAAiD,aAAa;AAC9D;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gCAAgC,WAAW,EAAE,KAAK,EAAE,eAAe;AACnE;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA,yBAAyB,0CAA0C;AACnE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B,WAAW;AACrC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,uCAAuC,GAAG;AAC1C;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAmB,0CAA0C;AAC7D,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,KAAK;;AAEL;AACA,GAAG;AACH,CAAC;;AAED;AACA,cAAc,4CAAI;AAClB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAE8D;;;;;;;;;;;;;;;;;ACjY1B;AACU;;AAE9C,gBAAgB,6CAA6C;AAC7D,EAAE,4CAAI;AACN;AACA,2CAA2C,KAAK,OAAO;AACvD,MAAM,2BAA2B,KAAK;AACtC,OAAO;AACP;AACA,MAAM;AACN;AACA;AACA;AACA,YAAY,4CAAI;AAChB,0BAA0B,EAAE,GAAG,EAAE;AACjC,4BAA4B,0DAAkB,OAAO;AACrD,gBAAgB;AAChB;AACA;AACA;AACA;AACA;;AAEA,iEAAe,KAAK,EAAC;;;;;;;;;;;;;;;;;;;ACxBsB;AACG;AACjB;AACD;;AAE5B;AACA,oBAAoB,uDAAW;;AAE/B;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,QAAQ,gDAAU;AAClB;AACA;;AAEA,MAAM,gDAAU;AAChB,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,0DAAkB,qBAAqB;AAChE;AACA,GAAG;;AAEH,SAAS,+CAAK;AACd;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA,iEAAe,WAAW,EAAC;;;;;;;;;;;;;;;;;;;;;;;;;AC5C3B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,qCAAqC,cAAc;AACnD;;AAEA;AACA;AACA;AACA;;AAEA,gCAAgC,UAAU;AAC1C;AACA;;AAEA;AACA;AACA;;AAEA;AACA,mBAAmB,UAAU;AAC7B;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;;AAEA,iEAAe,KAAK,EAAC;;;;;;;;;;;;;;;;AC1CW;;AAEhC;AACA,qBAAqB,WAAW;AAChC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA,sBAAsB,6BAA6B;AACnD;;AAEA,eAAe,4CAAI;AACnB;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,yCAAyC,UAAU,GAAG,EAAE,IAAI,GAAG;;AAE/D;AACA;AACA;;AAEA;;AAEA;AACA,cAAc,WAAW;AACzB;AACA;AACA;AACA,OAAO;AACP;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM,WAAW,cAAc;;AAE/B;AACA;AACA;;AAEA;AACA,8BAA8B,EAAE,IAAI,EAAE;AACtC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iEAAe,SAAS,EAAC;;;;;;;;;;;;;;;;;AC5KzB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,CAAC;;AAEoD;;;;;;;;;;;;;;;ACpBrD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,iEAAe,IAAI,EAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;AClBpB;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,gCAAgC;AAC3E;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iEAAe,CAAC,EAAC;AACmB;;;;;;;UCzCpC;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,wCAAwC,yCAAyC;WACjF;WACA;WACA,E;;;;;WCPA,wF;;;;;WCAA;WACA;WACA;WACA,sDAAsD,kBAAkB;WACxE;WACA,+CAA+C,cAAc;WAC7D,E;;;;;;;;;;;;;ACNqC;AACb;;AAExB,0BAA0B,kDAAM,CAAC,6CAAG","file":"main.js","sourcesContent":["import Game from './Game';\nimport { html, createState } from './component';\n\nconst App = () => {\n  const isGameStart = createState(false);\n  let mode = 'test';\n\n  const changeMode = (e) => {\n    mode = e.target.value;\n  };\n\n  const startGame = () => {\n    isGameStart.value = true;\n  };\n\n  const restartGame = () => {\n    isGameStart.value = false;\n    mode = 'test';\n  };\n\n  return html`<div>\n    <h1>Battleship</h1>\n    <div\n      ${{\n        $content: isGameStart.bindValue((val) =>\n          !val\n            ? html`\n                <label for=\"mode\">Choose difficulty:</label>\n                <select name=\"mode\" ${{ onChange: changeMode }}>\n                  <option value=\"test\" selected>Test</option>\n                  <option value=\"normal\">Normal</option>\n                  <option value=\"medium\">Intermediate</option>\n                  <option value=\"hard\">Hard</option>\n                </select>\n                <button ${{ onClick: startGame }}>Start game</button>\n              `\n            : html`${Game(mode, restartGame)}`\n        ),\n      }}\n    ></div>\n  </div>`;\n};\n\nexport default App;\n","import { createState, html } from './component';\nimport Board from './components/Board';\nimport Ship from './modules/Ship';\nimport Gameboard from './modules/Gameboard';\nimport { doRandomAttack, doRandomPlacing } from './modules/Player';\nimport difficulty from './difficulty.json';\nimport allShipDetails from './ships.json';\nimport $, { determineCellClass } from './utils';\nimport PlayerBoard from './components/PlayerBoard';\nimport event from './event';\n\nconst Game = (mode, restartGame) => {\n  const aiPastMoves = [];\n  const currentTurn = createState(0);\n  const isFinishPlacing = createState(false);\n  const { size, ships } = difficulty[mode];\n\n  const placeShipsInRandom = () => {\n    const currentBoard = Gameboard(size);\n\n    const allShips = [...ships];\n    let currentShip = null;\n\n    while (allShips.length) {\n      currentShip = allShips.shift();\n\n      let currentCount = currentShip.number;\n      while (currentCount) {\n        const move = doRandomPlacing(size);\n        const shipDetails = allShipDetails[currentShip.name];\n        const ship = new Ship(shipDetails.name, shipDetails.length);\n\n        try {\n          currentBoard.placeShip({ ship, ...move });\n          currentCount -= 1;\n        } catch (error) {\n          // console.warn(error.toString());\n          continue;\n        }\n      }\n    }\n\n    return currentBoard;\n  };\n\n  const initBoard = createState({\n    player: placeShipsInRandom(),\n    enemy: placeShipsInRandom(),\n  });\n\n  const randomize = () => {\n    initBoard.value = {\n      player: placeShipsInRandom(),\n      enemy: placeShipsInRandom(),\n    };\n  };\n\n  const finishPlacing = () => {\n    isFinishPlacing.value = true;\n  };\n\n  const syncCellToBoard =\n    (player = 'player') =>\n    ([x, y]) => ({\n      $class: initBoard.bindValue(\n        (state) =>\n          `cell ${determineCellClass(\n            state[player].get(x, y),\n            player === 'player'\n          )}`\n      ),\n    });\n\n  const aiAttack = () => {\n    const move = doRandomAttack(size, aiPastMoves).join('-');\n    $(`[data-board-name=\"player\"] .cell[data-pos=\"${move}\"]`).click();\n    aiPastMoves.push(move);\n  };\n\n  event.on('game over', (playerNum) => {\n    alert(`player ${playerNum} lose!`);\n    setTimeout(restartGame, 500);\n  });\n  event.on('next turn', () => {\n    currentTurn.value = +!currentTurn.value;\n\n    if (currentTurn.value) {\n      setTimeout(aiAttack, 500);\n    }\n  });\n\n  return html`\n    <button ${{ onClick: restartGame }}>Restart</button>\n    <div\n      ${{\n        $content: isFinishPlacing.bindValue((val) =>\n          !val\n            ? html`<button ${{ onClick: randomize }}>Randomize</button>\n                <button ${{ onClick: finishPlacing }}>Finish placing</button>\n                <div style=\"display: flex;\">\n                  ${Board({\n                    size,\n                    board: initBoard.value.player.getBoard(),\n                    cellProps: syncCellToBoard(),\n                  })}\n                  ${Board({\n                    size,\n                    board: initBoard.value.enemy.getBoard(),\n                    cellProps: syncCellToBoard('enemy'),\n                  })}\n                </div>`\n            : html`<div style=\"display: flex;\">\n                ${PlayerBoard(0, size, initBoard.value.player, currentTurn)}\n                ${PlayerBoard(1, size, initBoard.value.enemy, currentTurn)}\n              </div>`\n        ),\n      }}\n    ></div>\n  `;\n};\n\nexport default Game;\n","import { uuid } from './utils';\n\nconst stateStore = new Map();\nconst defaultProps = ['textContent', 'innerHTML', 'outerHTML', 'innerText'];\nconst booleanAttributes = [\n  'checked',\n  'selected',\n  'disabled',\n  'readonly',\n  'multiple',\n  'ismap',\n  'noresize',\n  'reversed',\n  'autocomplete',\n];\n\nconst isObject = (val) => typeof val === 'object';\nconst isArray = (val) => Array.isArray(val);\nconst isTemplate = (val) => val._type && val._type === 'template';\nconst isEventListeners = (val) =>\n  isObject(val) && Object.keys(val).every((key) => key.startsWith('on'));\nconst isState = (val) =>\n  isObject(val) && Object.keys(val).every((key) => key.startsWith('$'));\nconst isBooleanAttribute = (val) => booleanAttributes.includes(val);\nconst isStyleAttribute = (str) => str.startsWith('$style:');\nconst isDefaultProps = (val) =>\n  isObject(val) && Object.keys(val).every((key) => defaultProps.includes(key));\n\nconst _handlerTypeReducer = (str) => {\n  let type;\n  if (defaultProps.includes(str.replace('$', ''))) {\n    type = 'prop';\n  } else if (isStyleAttribute(str)) {\n    type = 'style';\n  } else if (str.replace('$', '') === 'content') {\n    type = 'content';\n  } else {\n    type = 'attr';\n  }\n\n  return type;\n};\n\nconst _handlerValueReducer = (type, obj) => {\n  switch (type) {\n    case 'listener':\n      return {\n        name: obj[0].replace('on', '').toLowerCase(),\n        value: obj[1],\n      };\n    case 'prop':\n      return {\n        name: obj[0].replace('$', ''),\n        value: obj[1],\n      };\n    case 'attr':\n      return {\n        name: obj[0].replace('$', ''),\n        value: obj[1],\n      };\n    case 'style':\n      return {\n        name: obj[0],\n        value: obj[1],\n      };\n    case 'text':\n      return {\n        value: obj[1],\n      };\n    case 'content':\n      return {\n        value: obj[1],\n      };\n    default:\n      throw new Error('Invalid handler type.');\n  }\n};\n\nconst _generateHandler = (type, obj) => {\n  const arr = [];\n  const id = uuid();\n  const attrName = `data-${type}-id`;\n  const dataAttr = `${attrName}=\"${id}\"`;\n\n  Object.entries(obj).forEach((item) => {\n    arr.push({\n      type,\n      query: `[${dataAttr}]`,\n      data: _handlerValueReducer(type, item),\n      attr: attrName,\n      remove: false,\n    });\n  });\n\n  arr[arr.length - 1].remove = true;\n\n  return [arr, dataAttr];\n};\n\nconst _bindState = (state) => {\n  const id = uuid();\n  const proxyId = `data-proxy-id=\"${id}\"`;\n  const handlers = {};\n\n  Object.entries(state).forEach(([key, handler]) => {\n    const bindedElements = stateStore.get(handler._id);\n    const existingHandlers = bindedElements.get(id) || [];\n\n    const finalValue = handler.trap\n      ? handler.trap.call(null, handler.value)\n      : handler.value;\n    const target = key.replace('$style:', '').replace('$', '');\n    const type = _handlerTypeReducer(key);\n\n    // Store the new handlers\n    bindedElements.set(id, [\n      ...existingHandlers,\n      {\n        type,\n        target,\n        propName: handler.propName,\n        trap: handler.trap,\n      },\n    ]);\n\n    if (!handlers[type]) {\n      handlers[type] = {};\n    }\n\n    handlers[type][target] = finalValue;\n  });\n\n  const [allHandlers, str] = Object.entries(handlers)\n    .map(([type, obj]) => _generateHandler(type, obj))\n    .reduce(\n      (prev, current) => [\n        [...prev[0], ...current[0]],\n        [...prev[1], current[1]],\n      ],\n      [[], []]\n    );\n\n  return [allHandlers, `${proxyId} ${str.join(' ')}`];\n};\n\n// return value is [str, array]\nconst _parser = (expr, handlers = []) => {\n  // if expr is array, map and parse each item\n  // items must be all strings after parsing\n  if (isArray(expr)) {\n    const [strArray, handlersArray] = expr\n      .map((item) => _parser(item, handlers))\n      .reduce(\n        (prev, current) => [\n          [...prev[0], current[0]],\n          [...prev[1], ...current[1]],\n        ],\n        [[], []]\n      );\n\n    return [strArray.join(''), handlersArray];\n  }\n\n  // if template\n  // add its handlers to ours\n  // then return the string\n  if (isTemplate(expr)) {\n    return [expr[0], [...handlers, ...expr[1]]];\n  }\n\n  // if Object and that object contains only keys which name is an event\n  // generate a temporary id and replace the object with it\n  // then add the event listeners to our handlers\n  if (isEventListeners(expr)) {\n    const [eventHandlers, id] = _generateHandler('listener', expr);\n\n    return [id, [...handlers, ...eventHandlers]];\n  }\n\n  if (isState(expr)) {\n    const [propHandlers, id] = _bindState(expr);\n    return [id, [...handlers, ...propHandlers]];\n  }\n\n  if (isDefaultProps(expr)) {\n    const [defaultPropHandlers, id] = _generateHandler('prop', expr);\n    return [id, [...handlers, ...defaultPropHandlers]];\n  }\n\n  // if none of our accepted types, assume it is string\n  // then just return it\n  return [`${expr}`, []];\n};\n\nconst _createTemplate = (arr) => {\n  const arrayLikeObj = {};\n\n  arr.forEach((i, idx) => {\n    arrayLikeObj[idx] = arr[idx];\n  });\n\n  arrayLikeObj.length = arr.length;\n  arrayLikeObj._type = 'template';\n\n  Object.defineProperty(arrayLikeObj, '_type', {\n    enumerable: false,\n  });\n\n  return arrayLikeObj;\n};\n\nconst _replacePlaceholders = (str) => {\n  let newString = str;\n  let match = newString.match(/{%\\s*(.*)\\s*%}/);\n  const handlers = [];\n\n  while (match) {\n    const [textHandlers, id] = _generateHandler('text', {\n      text: match[1].trim(),\n    });\n\n    handlers.push(...textHandlers);\n\n    newString = newString.replace(match[0], `<i ${id}></i>`);\n\n    match = newString.slice(match.index).match(/{%\\s*(.*)\\s*%}/);\n  }\n\n  return [newString, handlers];\n};\n\nconst parseString = (strings, ...exprs) => {\n  const [evaluatedExprs, handlers] = exprs\n    .map((expr) => _parser(expr))\n    .reduce(\n      (prev, current) => [\n        [...prev[0], current[0]],\n        [...prev[1], ...current[1]],\n      ],\n      [[], []]\n    );\n\n  const htmlString = evaluatedExprs.reduce(\n    (fullString, expr, i) => `${fullString}${expr}${strings[i + 1]}`,\n    strings[0]\n  );\n\n  const [sanitizedString, textHandlers] = _replacePlaceholders(htmlString);\n  handlers.push(...textHandlers);\n\n  return _createTemplate([sanitizedString, handlers]);\n};\n\nconst html = (strings, ...exprs) => parseString(strings, ...exprs);\n\nconst _modifyElement = ({ element, type, data, context = document }) => {\n  const el = context.querySelector(element);\n\n  switch (type) {\n    case 'prop':\n      el[data.name] = data.value;\n      break;\n    case 'attr':\n      if (isBooleanAttribute(data.name)) {\n        if (data.value) {\n          el.setAttribute(data.name, '');\n        } else {\n          el.removeAttribute(data.name);\n        }\n      } else {\n        el.setAttribute(data.name, data.value);\n      }\n\n      break;\n    case 'listener':\n      el.addEventListener(data.name, data.value);\n      break;\n    case 'text':\n      el.replaceWith(document.createTextNode(data.value));\n      break;\n    case 'style':\n      el.style[data.name] = data.value;\n      break;\n    case 'content':\n      [...el.children].map((child) => child.remove());\n\n      el.appendChild(\n        data.value instanceof HTMLElement\n          ? data.value\n          : render(html`${data.value}`)\n      );\n\n      break;\n    default:\n      throw new Error('Invalid type.');\n  }\n};\n\nconst createElementFromString = (str, handlers = []) => {\n  const createdElement = document.createRange().createContextualFragment(str);\n\n  handlers.forEach((handler) => {\n    const el = createdElement.querySelector(handler.query);\n\n    if (!el) return;\n\n    _modifyElement({\n      element: handler.query,\n      type: handler.type,\n      data: handler.data,\n      context: createdElement,\n    });\n\n    if (handler.remove) {\n      el.removeAttribute(handler.attr);\n    }\n  });\n\n  return createdElement;\n};\n\nconst render = (template) => createElementFromString(...Array.from(template));\n\nconst _setHandler = (stateId) => ({\n  set: (target, prop, value, receiver) => {\n    const bindedElements = stateStore.get(stateId);\n\n    bindedElements.forEach((handlers, id) => {\n      const query = `[data-proxy-id=\"${id}\"]`;\n      const el = document.querySelector(query);\n\n      if (el) {\n        handlers.forEach((handler) => {\n          if (prop !== handler.propName) return;\n\n          const finalValue = handler.trap\n            ? handler.trap.call(null, value)\n            : value;\n\n          _modifyElement({\n            element: query,\n            type: handler.type,\n            data: { name: handler.target, value: finalValue },\n          });\n        });\n      } else {\n        // delete handler when the target is unreachable (most likely deleted)\n        bindedElements.delete(id);\n      }\n    });\n\n    return Reflect.set(target, prop, value, receiver);\n  },\n});\n\nconst createState = (initValue = null) => {\n  const _id = uuid();\n  // Map contains id keys\n  // id keys are proxy ids of elements binded to the state\n  stateStore.set(_id, new Map());\n\n  const state = {\n    bindValue: (trap = null) => ({\n      propName: 'value',\n      trap,\n      _id,\n      value: state.value,\n    }),\n    bind: (propName = 'value', trap = null) => ({\n      propName,\n      trap,\n      _id,\n      value: propName === 'value' ? state.value : state.value[propName],\n    }),\n  };\n\n  if (isObject(initValue)) {\n    state.value = new Proxy(initValue, _setHandler(_id));\n  } else {\n    state.value = initValue;\n  }\n\n  return new Proxy(state, _setHandler(_id));\n};\n\nexport { html, render, createElementFromString, createState };\n","import { html } from '../component';\nimport { determineCellClass } from '../utils';\n\nconst Board = ({ name, size, board, clickHandler, cellProps }) =>\n  html`<div\n    class=\"grid\"\n    style=\"grid-template-columns: repeat(${size}, 1fr);\"\n    ${name ? `data-board-name=\"${name}\"` : ''}\n    ${{ onClick: clickHandler }}\n  >\n    ${board\n      .map((row, i) =>\n        row.map(\n          (cell, j) =>\n            html`<div\n              data-pos=\"${i}-${j}\"\n              class=\"cell ${determineCellClass(cell)}\"\n              ${cellProps.call(null, [i, j])}\n            ></div>`\n        )\n      )\n      .flat()}\n  </div>`;\n\nexport default Board;\n","import { createState } from '../component';\nimport { determineCellClass } from '../utils';\nimport event from '../event';\nimport Board from './Board';\n\nconst PlayerBoard = (type, size, gameboard, currentTurn) => {\n  const thisBoard = createState(gameboard.getBoard());\n\n  const clickHandler = (e) => {\n    if (!e.target.matches('.cell')) return;\n    if (type === currentTurn.value) return;\n\n    try {\n      const [x, y] = e.target.getAttribute('data-pos').split('-');\n\n      gameboard.receiveAttack(x, y);\n      thisBoard.value = gameboard.getBoard();\n\n      if (gameboard.isGameOver()) {\n        event.emit('game over', type);\n        return;\n      }\n\n      event.emit('next turn');\n    } catch (error) {\n      console.warn(error.toString());\n    }\n  };\n\n  const syncCellToBoard = ([x, y]) => ({\n    $class: thisBoard.bindValue(\n      (board) => `cell ${determineCellClass(board[x][y], !type)}`\n    ),\n  });\n\n  return Board({\n    size,\n    clickHandler,\n    name: !type ? 'player' : 'enemy',\n    board: thisBoard.value,\n    cellProps: syncCellToBoard,\n  });\n};\n\nexport default PlayerBoard;\n","class EventEmitter {\n  constructor() {\n    this.events = new Map();\n  }\n\n  on(eventName, fn, options) {\n    if (!this.events.has(eventName)) {\n      this.events.set(eventName, []);\n    }\n\n    this.events.get(eventName).push({ fn, options });\n  }\n\n  off(eventName, fn) {\n    const handlers = this.events\n      .get(eventName)\n      .filter((handler) => handler.fn !== fn);\n\n    console.log(`Shutting off ${eventName}...`);\n    this.events.set(eventName, handlers);\n  }\n\n  clear() {\n    this.events.clear();\n  }\n\n  emit(eventName, payload = null) {\n    console.log(`${eventName} event emitted... `);\n    const handlers = this.events.get(eventName) || [];\n\n    handlers.forEach((handler) => {\n      handler.fn.call(null, payload);\n\n      if (handler.options && handler.options.once) {\n        this.off(eventName, handler.fn);\n      }\n    });\n  }\n}\n\nconst event = new EventEmitter();\n\nexport default event;\n","import { uuid } from '../utils';\n\nconst tryCatchForLoop = (limit, fn, start = 0) => {\n  for (let i = start; i < limit; i++) {\n    try {\n      fn.call(null, i);\n    } catch (error) {\n      continue;\n    }\n  }\n};\n\nconst Gameboard = (size) => {\n  const state = {\n    ships: new Map(),\n  };\n\n  let board = [...new Array(size).fill([])].map(() => [\n    ...new Array(size).fill(null),\n  ]);\n\n  const reset = () => {\n    board = [...new Array(size).fill([])].map(() => [\n      ...new Array(size).fill(null),\n    ]);\n    state.ships.clear();\n  };\n\n  const get = (row, col) => {\n    if (row < 0 || row > size - 1 || col < 0 || col > size - 1) {\n      throw new Error('Coordinates is off bounds');\n    }\n\n    return board[row][col];\n  };\n\n  const getBoard = () => [...board].map((row) => [...row]);\n\n  const setBoard = (newBoard) => {\n    board = newBoard;\n  };\n\n  const _markSurroundings = (pos, length, direction) => {\n    const boardCopy = getBoard();\n    const [rowLimit, columnLimit] =\n      direction === 'y' ? [length + 2, 2] : [2, length + 2];\n\n    const start = [pos.start.row - 1, pos.start.col - 1];\n    const end = [pos.end.row + 1, pos.end.col + 1];\n\n    tryCatchForLoop(columnLimit, (i) => {\n      get(start[0], start[1] + i);\n      boardCopy[start[0]][start[1] + i] = undefined;\n    });\n    tryCatchForLoop(columnLimit, (i) => {\n      get(end[0], end[1] - i);\n      boardCopy[end[0]][end[1] - i] = undefined;\n    });\n    tryCatchForLoop(rowLimit, (i) => {\n      get(start[0] + i, start[1]);\n      boardCopy[start[0] + i][start[1]] = undefined;\n    });\n    tryCatchForLoop(rowLimit, (i) => {\n      get(end[0] - i, end[1]);\n      boardCopy[end[0] - i][end[1]] = undefined;\n    });\n\n    setBoard(boardCopy);\n  };\n\n  const placeShip = ({ pos, ship, direction = 'x' }) => {\n    const boardCopy = getBoard();\n\n    const id = uuid(4);\n    state.ships.set(id, ship);\n\n    const [rowIncrement, columnIncrement] = direction === 'y' ? [1, 0] : [0, 1];\n    const [row, col] = pos;\n\n    // Check if cell is already marked\n    if (typeof get(row, col) === 'string') throw new Error('Cell occupied');\n\n    let xi = 0;\n    let yi = 0;\n\n    for (let i = 0; i < ship.length; i++) {\n      let marker;\n\n      // Check if placing will result in ship\n      // to go off the board\n      try {\n        marker = get(row + yi, col + xi);\n      } catch (error) {\n        throw new Error('Ship off-bounds');\n      }\n\n      // Throw error if placing will result in the ship\n      // occupying another ship's surroundings\n      if (marker === undefined) throw new Error('Cell within a ship territory');\n\n      // Throw error when placing will result in overlap\n      if (marker !== null) throw new Error('Ship overlaps');\n\n      boardCopy[row + yi][col + xi] = `${ship.name}[${i}]_${id}`;\n\n      xi += columnIncrement;\n      yi += rowIncrement;\n    }\n\n    setBoard(boardCopy);\n\n    const coordinates = {\n      start: { row, col },\n      end: {\n        row: direction === 'y' ? row + ship.length - 1 : row,\n        col: direction === 'x' ? col + ship.length - 1 : col,\n      },\n    };\n\n    _markSurroundings(coordinates, ship.length, direction);\n\n    return true;\n  };\n\n  const isGameOver = () =>\n    board.every((row) =>\n      row.every((cell) => ['HIT', 'MISS', null, undefined].includes(cell))\n    );\n\n  // v2\n  // return Array.from(state.ships, ([key, value]) => ({\n  //   key,\n  //   value,\n  // })).every(({ value: ship }) => ship.isSunk());\n\n  const receiveAttack = (x, y) => {\n    const boardCopy = getBoard();\n    const marker = get(x, y);\n\n    if (marker === 'HIT' || marker === 'MISS') {\n      throw new Error(`Cell[${x}][${y}] was already selected`);\n    }\n\n    if (!marker) {\n      boardCopy[x][y] = 'MISS';\n      setBoard(boardCopy);\n\n      return false;\n    }\n\n    const index = marker.match(/\\[(\\d)\\]/)[1];\n    const id = marker.split('_')[1];\n\n    const ship = state.ships.get(id);\n    ship.hit(index);\n\n    boardCopy[x][y] = 'HIT';\n    setBoard(boardCopy);\n\n    return true;\n  };\n\n  return {\n    get,\n    getBoard,\n    reset,\n    placeShip,\n    receiveAttack,\n    isGameOver,\n  };\n};\n\nexport default Gameboard;\n","const makeMove = (size) => [\n  Math.floor(Math.random() * size),\n  Math.floor(Math.random() * size),\n];\n\nconst doRandomAttack = (size, pastMoves = []) => {\n  let move;\n\n  do {\n    move = makeMove(size);\n  } while (pastMoves.includes(move.join('-')));\n\n  return move;\n};\n\nconst doRandomPlacing = (size) => ({\n  pos: makeMove(size),\n  direction: Math.floor(Math.random() * 2) ? 'x' : 'y',\n});\n\nexport { makeMove, doRandomAttack, doRandomPlacing };\n","class Ship {\n  constructor(name, length) {\n    this.name = name;\n    this.length = length;\n    this.body = new Array(length).fill('O');\n  }\n\n  hit(coord) {\n    this.body[coord] = 'X';\n\n    return this;\n  }\n\n  isSunk() {\n    return this.body.every((part) => part === 'X');\n  }\n}\n\nexport default Ship;\n","const uuid = (length = 10) => Math.random().toString(36).substr(2, length);\n\nconst $ = (query) => {\n  const [idFlag, allFlag, dataAttrFlag] = ['#', '--a', '@'];\n\n  const isId = query.includes(idFlag);\n  const isAll = query.includes(allFlag);\n  const isDataAttr = query.includes(dataAttrFlag);\n  const isDescendantSelector = query.includes(' ');\n\n  if (isId && !isDescendantSelector) {\n    return document.getElementById(query.replace(idFlag, ''));\n  }\n  if (isAll) {\n    return document.querySelectorAll(query.replace(allFlag, ''));\n  }\n  if (isDataAttr && !isDescendantSelector) {\n    return document.querySelector(`[data-${query.replace(dataAttrFlag, '')}]`);\n  }\n\n  return document.querySelector(query);\n};\n\nconst determineCellClass = (cell, isPlayer) => {\n  switch (cell) {\n    case 'HIT':\n      return 'hit';\n    case 'MISS':\n      return 'missed';\n    case 'SUNK':\n      return 'sunk';\n    case undefined:\n      return 'occupied';\n    case null:\n      return '';\n    default:\n      return isPlayer ? 'ship' : '';\n  }\n};\n\nexport default $;\nexport { uuid, determineCellClass };\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { render } from './component';\nimport App from './App';\n\ndocument.body.appendChild(render(App()));\n"],"sourceRoot":""}